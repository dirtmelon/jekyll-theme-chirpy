<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="《 Web 性能权威指南》阅读笔记 - 无线网络性能" /><meta name="author" content="dirtmelon" /><meta property="og:locale" content="en_US" /><meta name="description" content="无线网络概览 无线网络的性能基础 所有无线技术都有自身的约束和局限。然而，无论使用哪种无线技术，所有通信方法都有一个最大的信道容量，这个容量是由相同的底层原理决定的。 香农公式：" /><meta property="og:description" content="无线网络概览 无线网络的性能基础 所有无线技术都有自身的约束和局限。然而，无论使用哪种无线技术，所有通信方法都有一个最大的信道容量，这个容量是由相同的底层原理决定的。 香农公式：" /><link rel="canonical" href="https://dirtmelon.github.io/posts/high-performance-browser-networking-third/" /><meta property="og:url" content="https://dirtmelon.github.io/posts/high-performance-browser-networking-third/" /><meta property="og:site_name" content="Dirtmelon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-02T17:56:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="《 Web 性能权威指南》阅读笔记 - 无线网络性能" /><meta name="twitter:site" content="@Dirt_melon" /><meta name="twitter:creator" content="@dirtmelon" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"dirtmelon"},"description":"无线网络概览 无线网络的性能基础 所有无线技术都有自身的约束和局限。然而，无论使用哪种无线技术，所有通信方法都有一个最大的信道容量，这个容量是由相同的底层原理决定的。 香农公式：","url":"https://dirtmelon.github.io/posts/high-performance-browser-networking-third/","headline":"《 Web 性能权威指南》阅读笔记 - 无线网络性能","dateModified":"2020-11-24T10:44:47+08:00","datePublished":"2020-11-02T17:56:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dirtmelon.github.io/posts/high-performance-browser-networking-third/"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>《 Web 性能权威指南》阅读笔记 - 无线网络性能 | Dirtmelon</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Dirtmelon"><meta name="application-name" content="Dirtmelon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/apple-icon.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Dirtmelon</a></div><div class="site-subtitle font-italic">Dirtmelon's blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/dirtmelon" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/Dirt_melon" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['0xffdirtmelon','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>《 Web 性能权威指南》阅读笔记 - 无线网络性能</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>《 Web 性能权威指南》阅读笔记 - 无线网络性能</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> dirtmelon </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Nov 2, 2020, 5:56 PM +0800" prep="on" > Nov 2, 2020 <i class="unloaded">2020-11-02T17:56:00+08:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Nov 24, 2020, 10:44 AM +0800" prefix="Updated " > Nov 24, 2020 <i class="unloaded">2020-11-24T10:44:47+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4726 words">26 min</span></div></div><div class="post-content"><h2 id="无线网络概览">无线网络概览</h2><h3 id="无线网络的性能基础">无线网络的性能基础</h3><p>所有无线技术都有自身的约束和局限。然而，无论使用哪种无线技术，所有通信方法都有一个最大的信道容量，这个容量是由相同的底层原理决定的。 香农公式： <img data-proofer-ignore data-src="/media/1872190F-4B8E-4CAE-AC4E-50EF1BF13AD5.png" alt="1872190F-4B8E-4CAE-AC4E-50EF1BF13AD5" /></p><ul><li>C 是信道容量，单位是 bit/s ；<li>BW 是可用带宽，单位是 Hz ；<li>S 是信号， N 是噪声，单位是 W 。 在所有这些因素中，与数据传输速度最直接相关的就是接收端与发送端之间的可用带宽和信号强度。</ul><h4 id="带宽">带宽</h4><p>有线网络通过线缆将网络中的各个节点连接起来，而无线电通信本质上则是一个共享媒体，它靠的是无线电波，或者专业一点讲，叫做电磁辐射。为实现通信，发送端与接收端必须事先就通信使用的频率范围达成共识，在这个频率范围内双方可以顺畅地交换信息。 除了以共有频段作为信息交互的基础外，影响性能的最主要因素就是频率范围的大小（带宽）。根据香农的模型，信道的总体比特率与分配的带宽呈正比。换句话说，在其他条件等同的情况下，频率范围加倍，传输速度加倍。</p><h4 id="信号强度">信号强度</h4><p>除了带宽之外，无线通信的第二个限制因素就是收发两端之间的信号强度，也叫信噪比（ SNR ， Signal Noise Ratio ）。本质上，信噪比衡量的是预期信号强度与背景噪声及干扰之间的比值。背景噪声越大，携带信息的信号就必须越强。</p><p>任何无线网络，无论它叫什么名字，缩写是什么或者修订版本是多少，其性能归根结底都受限于几个众所周知的因素。特别是分配给它的带宽大小和收发两端的信噪比。另外，所有利用无线电的通信都：通过共享的通信媒体（无线电波）实现；在管制下使用特定频率范围；在管制下使用特定的发射功率；受限于不断变化的背景噪声和干扰；受限于所选无线技术的技术约束；受限于设备本身的限制，比如形状、电源，等等。</p><h3 id="测量现实中的无线性能">测量现实中的无线性能</h3><p>任何无线网络，无论它叫什么名字，缩写是什么或者修订版本是多少，其性能归根结底都受限于几个众所周知的因素。特别是分配给它的带宽大小和收发两端的信噪比。另外，所有利用无线电的通信都：</p><ul><li>通过共享的通信媒体（无线电波）实现；<li>在管制下使用特定频率范围；<li>在管制下使用特定的发射功率；<li>受限于不断变化的背景噪声和干扰；<li>受限于所选无线技术的技术约束；<li>受限于设备本身的限制，比如形状、电源，等等。</ul><h2 id="wi-fi">Wi-Fi</h2><p>Wi-Fi 工作于免许可的ISM频段，任何人在任何地方都可以轻易部署，必要的硬件也很便宜很简单。</p><h3 id="从以太网到无线局域网">从以太网到无线局域网</h3><p>802.11 无线标准主要是作为既有以太网标准（ 802.3 ）的扩展来设计的。事实上，以太网通常被称作局域网（ LAN ）标准，而802.11 标准族则相应地被称作无线局域网（ WLAN，Wireless LAN ）标准。 <img data-proofer-ignore data-src="/media/5FA13F96-FF78-4D39-A229-0ED1BEDEEC86.png" alt="5FA13F96-FF78-4D39-A229-0ED1BEDEE" /></p><p>802.3 （以太网）和 802.11 (Wi-Fi) 的数据和物理层。</p><p>Wi-Fi 采用了冲突避免机制 （CSMA/CA ， Collision Avoidance ）机制，每个发送方都会在自己认为信道空闲时发送数据，以避免冲突。为此，每个Wi-Fi数据帧必须明确得到接收方的确认，以确保不发生冲突。</p><h3 id="wi-fi-性能与测量">Wi-Fi 性能与测量</h3><p>Wi-Fi 标准没有规定任何中央调度机制，因而对任何客户端的吞吐量和延迟都不提供保证。 新的 WMM (Wi-Fi Multimedia ， Wi-Fi 多媒体）扩展支持在无线电接口中对需要的低延迟应用（语音，视频等）启用基本的 QoS (Quality of Service ，服务质量)，但是能识别的路由器和客户端都比较少，而且会和附近的 Wi-Fi 网络争用共享的无线资源，这是无法避免的。 Wi-Fi 网络之所以无处不在，主要原因就是它部署简单，而正因为部署简单，才会带来当前的性能问题。事实上，在城市繁华地段或者写字楼中，数十个 Wi-Fi 网络重叠的现象并不罕见： <img data-proofer-ignore data-src="/media/6A30C39D-0D7C-42F3-9E68-D7987B3E2499.png" alt="6A30C39D-0D7C-42F3-9E68-D7987B3E2499" /></p><p>2.4 GHz 和 5 GHz 的 Wi-Fi 重叠。</p><ol><li>多个 Wi-Fi 路由器共享带宽导致性能问题；<li>从客户端到 Wi-Fi 接入点的第一跳需要多长时间没有保证； 如果你积极地采用新技术，那很可能显著提升 Wi-Fi 网络的性能。新的 802.11n 和 802.11ac 标准使用 5 GHz 频段，不仅拓宽了频率范围，而且能保证在多数环境下不发生冲突。 换句话说，至少在目前，如果你附近没有什么（像你一样的）技术大牛，那么一台双频路由器（支持 2.4GHz 和 5 GHz ）既能兼容 2.4 GHz 的老客户端，也能为支持 5 GHz 的客户端提供更好的性能。</ol><p>Wi-Fi 性能的重要因素：</p><ul><li>不保证用户的带宽和延迟时间；<li>信噪比不同，带宽也随之不同；<li>发射功率被限制在200 mW以内；<li>i在2.4 GHz和较新的5 GHz频段中的频谱有限；<li>信道分配决定了接入点信号会重叠；<li>接入点与客户端争用同一个无线信道。</ul><p>所有 Wi-Fi 协议的数据和物理层实现都有自己的重发和纠错机制，这些机制向上层隐藏了重发操作。 事实上，在 802.11n 之前， Wi-Fi 协议只允许同一时刻传输一个数据帧，这一帧必须得到链路层的确认才能继续发送下一帧。 802.11n 则引入了新的“帧聚合”功能，从而支持同时发送和确认多个 Wi-Fi 数据帧。除了直观的丢包问题， Wi-Fi 网络更突出的问题则是分组到达时间差异极大，这一切都要归咎于数据链路层和物理层的冲突及重发。</p><h3 id="针对-wi-fi-的优化建议">针对 Wi-Fi 的优化建议</h3><p>多使用不计流量的宽带网络，而不是 3G/4G 根据变化的带宽调整资源，如视频清晰度 适应可变的延迟时间， 有时候使用提供不可靠UDP传输的WebRTC倒不失为一个明智的选择。当然，传输方式的切换不能挽救无线网络，但却有助于降低协议和应用导致的延迟时间</p><h2 id="移动网络">移动网络</h2><h2 id="g字号移动网络简介">G字号移动网络简介</h2><p>每一代无线技术都以其峰值频谱效率（ bps/Hz ）为标志，为了让用户更直观地理解，这个效率会转换成数据传输速率，比如 4G 网络的传输速率以 Gbit/s 来衡量。 无论什么标准，每种网络真实的性能都会因提供商以及他们对网络的配置、每个小区内活跃用户的数量、特定位置的无线环境、使用的设备，以及影响无线性能的其他因素而异。</p><p><img data-proofer-ignore data-src="/media/382C4B1C-9958-418F-BCB5-ECCF6915B28A.png" alt="382C4B1C-9958-418F-BCB5-ECCF6915B28A" /></p><h3 id="最早提供数据服务的-2g">最早提供数据服务的 2G</h3><p>1991年，芬兰基于新兴的 GSM （ Global System for Mobile communications ，全球移动通信系统）标准建设了第一个2G网络，最早在无线电网络中引入了数字信令。</p><p>直到1990年代中期，GPRS （ General Packet Radio Service ，通用无线分组业务）被引入 GSM 标准，无线互联网才真正走向实用。</p><h3 id="3gpp-与-3gpp2">3GPP 与 3GPP2</h3><p>3GPP （ 3rd Generation Partnership Project ，第三代合作伙伴项目）负责制定 UMTS （ Universal Mobile TelecommunicationSystem ，通用移动通信系统），这是 3G 技术与 GSM 技术结合的产物。这个项目后来也负责维护 GSM 标准和制定新的LTE标准。 3GPP2 （ 3rd Generation Partnership Project 2 ）负责基于 CDMA2000 ，也就是高通制定的 IS-95 标准的后续技术制定 3G 规范 3G 网络存在两个主导且互不兼容的标准： UMTS 和 CDMA ，分别由 3GPP 和 3GPP2 制定。这两种标准同时也有自己的过渡性版本，通常被称为 3.5G， 3.75G 和 3.9G 。由于制定一个新标准需要很长时间，更重要的是，建设新网络需要巨额投资， 4G 的无线电接口及基础设备完全不同于 3G ，也为了很多购买了 3G 设备的用户的利益。因此 3GPP 和 3GPP2 一直在既有的 3G 标准基础上改进。</p><h3 id="3g-技术演进">3G 技术演进</h3><p>网络运营商和网络提供商一致认可 3GPP LTE 是各种网络共同的下一代4G标准。因此，很多 CDMA 网络运营商也率先投资建设了早期的 LTE 基础设施，以便在某种程度上保持对演进中的 HSPA+ 的竞争力。 换句话说，世界上的大多数移动运营商将把 HSPA+ 和 LTE 作为未来的移动无线标准。不用紧张，这应该是件好事。现有的 2G 和 3～3.75G 技术仍然是当前移动无线网络的主体，更重要的，它们至少还会继续为我们服务10年。 《Web 性能权威指南》写于 2013 年，现在是 2020 年，就中国地区来说 2G/3G 已经基本上被 4G 替代了， 5G 也在大力推广中。苹果也出了自己的第一代 5G手机— iPhone 12 。但是个人来说目前来说还看不到 5G 对于普通用户来说有多大的提升，或许等到 7 年以后又是另外一番景象吧。</p><h3 id="imt-advanced-的-4g-要求">IMT-Advanced 的 4G 要求</h3><p>4G 背后是一组具体要求（ IMT-Advanced ），这组要求是 ITU 在 2008 年就制定和公布了的。任何达到这些要求的技术，都可以看作是 4G 技术。 IMT-Advanced 的部分要求举例如下：</p><ul><li>以 IP 分组交换网络为基础；<li>与之前的无线标准（ 3G 和 2G ）兼容；<li>移动客户端的速率达到 100 Mbit/s ，静止时的速率达到 Gbit/s 以上；<li>100 ms 控制面延迟， 10 ms 用户面延迟；<li>资源在用户间动态分配和共享；<li>可变带宽分配， 5～20 Mhz 。</ul><h3 id="长期演进-lte-">长期演进（ LTE ）</h3><p>LTE （ Long Term Evolution ）标准：</p><ul><li>核心网络全部为 IP 分组交换网；<li>简化了网络架构，降低建设成本；<li>用户面和控制面的低延迟时间（分别为 &lt;10 ms 和 &lt;100 ms ）；<li>新无线接口及调制算法实现了高吞吐量（ 100Mbit/s ）；<li>可用于较大的带宽配置及运营商集群；要求所有设备支持 MIMO 。 由于其无线及核心网络的实现的差异， LTE 网络不是对已有 3G 基础设备的简单升级。相反， LTE 网络必须与现有 3G 基础设备并行部署，并采用不同的频率范围。不过，由于LTE是 UMTS 和 CDMA 的共同后继版本，因此它也提供了一种兼容二者的机制。由此， LTE 用户可以无缝切换到 3G 网络，并在 LTE 基础设施就绪后再迁移过来。</ul><h3 id="为多代并存的未来规划">为多代并存的未来规划</h3><p>首先，无线标准发展很快，但这些网络的物理设施建设则既要花钱又得花时间。将来，如果这些网络部署完成，那势必还要投入很多时间维护以收回成本，保证服务品质。换句话说，尽管市场上对 4G 的宣传炒作沸沸扬扬，老一代网络至少还得服务社会十年以上。所以，在创建移动 Web 应用时，应该考虑这一点。 在面向移动网络构建应用时，不能只考虑一种网络，更不能寄希望于特定的吞吐量或延迟时间。前面已经介绍过，任何网络的实际性能都具有高度可变性，取决于部署的版本、基础设施、无线条件，以及其他众多的因素。我们的应用要能适应不断变化的条件，吞吐量、延迟时间，甚至无线连接的有无，都可能变化。</p><h2 id="设备特性及能力">设备特性及能力</h2><p>经常被人忘记的一个事实，就是现有无线网络只是问题的一半。另一半当然是来自不同厂商的设备，以及它们的上市时间，这些设备各有各的特点。比如，CPU速度和核心数量、内存大小、存储能力、有无 GPU 等。这些因素中的任何一个都会影响设备以及运行于其上的应用的整体性能。</p><h2 id="无线电资源控制器--rrc-">无线电资源控制器 （ RRC ）</h2><p>3G和4G网络都有一个独特的装置，这个装置在有线网甚至Wi-Fi中都是不存在的。这个装置就是无线电资源控制器（RRC，Radio ResourceController ）。RRC负责调度协调移动设备与无线电基站之间所有的通信连接。 RRC 直接影响延迟、吞吐量和设备电池的使用时间。</p><p><img data-proofer-ignore data-src="/media/11E2E46B-AE45-47EF-8B50-398E2873F7E7.png" alt="11E2E46B-AE45-47EF-8B50-398E2873F7E7" /></p><h2 id="移动网络的优化建议">移动网络的优化建议</h2><h3 id="节约用电">节约用电</h3><p>移动网络的性能与电池使用时间天生联系在一起。而且，为了节约用电，无线接口的物理层还专门针对如下限制（或事实）做出了优化：</p><ul><li>全功率打开无线电模块只消几小时就可耗尽电量；<li>对无线电功率的需求随着无线标准演进与代俱增；<li>无线电模块的耗电量仅次于设备的屏幕；<li>数据传输时无线电通信的耗电过程是非线性的。<h3 id="消除周期性及无效的数据">消除周期性及无效的数据</h3><li>轮询在移动网络中代价极高，少用；<li>尽可能使用推送和通知；<li>出站和入站请求应该合并和汇总；<li>非关键性请求应该推迟到无线模块活动时进行；<li>消除不必要的长链接。 一般来说，推送比轮询效果更好。但频率过高的推送与轮询也不相上下。如果碰到实时更新的需求，应该考虑下列问题：<li>最佳更新间隔多长，是否符合用户预期？<li>除了固定的更新间隔，能否因地因时制宜？<li>入站或出站请求能否集合为更少的网络调用？<li>入站或出站请求能否推迟到以后发送？<h3 id="预测网络延迟上限">预测网络延迟上限</h3><p>在移动网络中，一个 HTTP 请求很可能会导致一连串长达几百甚至上几千毫秒的网络延迟。这一方面是因为有往返延迟，另一方面也不能忘记 DNS 、 TCP 、 TLS 及控制面的延迟。 一个 HTTP 请求的构成：</p></ul><p><img data-proofer-ignore data-src="/media/DF4C61BD-6532-4A22-89A2-206FA99F1BFE.png" alt="DF4C61BD-6532-4A22-89A2-206FA99F1BFE" /></p><p>一个 HTTP 请求的延迟：</p><p><img data-proofer-ignore data-src="/media/4F7BD0AA-84FA-4D6F-8316-28B49B47C01A.png" alt="4F7BD0AA-84FA-4D6F-8316-28B49B47C01A" /></p><p>解耦用户交互与网络通信： 设计得好的应用，即便底层连接慢或者请求时间长，通过在UI中提供即时反馈也能让人觉得速度快。不要把用户交互与网络通信联系得太过紧密。为给用户最佳体验，应用必须在几百毫秒内响应输入。</p><h3 id="面对多网络接口并存的现实">面对多网络接口并存的现实</h3><p>用户不喜欢速度慢的应用，但由于短暂网络错误导致的应用崩溃才是体验最差的。我们的移动应用必须足以应对各种常见的网络错误：无法访问的主机、吞吐量突然下降或延迟突然上升，甚至连接彻底断开。与有线网络不同，你不能假定一次连接成功就能持续保持连接状态。用户可能正在移动，可能进入了高冲突、用户多，或者信号差的区域。</p><ul><li>不要缓存或试图猜测网络状态；<li>调度请求、监听并诊断错误；<li>瞬态错误总会发生，不可忽视，可以采取重试策略；<li>监听连接状态，以便采用最佳请求方式；<li>对重试请求采用补偿算法，不要永远循环；　<li>离线时，尽可能记录并在将来发送请求；<li>利用 HTML5 的 AppCache 和 localStorage 实现离线应用。</ul><p>尽量使用 Wi-Fi 网络。</p><h3 id="遵循协议和应用最佳实践">遵循协议和应用最佳实践。</h3><p>网络基础设施的分层架构有一个最大的优点，那就是把物理交付接口从传输层中抽象了出来，而传输层又把路由和数据交付从应用协议中抽象了出来。这种分离的结果就是API具有独立性，但为了取得端到端的最佳性能，我们仍然要考虑整个架构。 通过重用持久连接、将服务器和数据部署到离客户端更近的地方、优化TLS部署，以及其他所有优化措施，对移动网络而言只会更加重要，因为移动网络的往返时间长，而带宽永远都很昂贵。</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/code/'>Code</a>, <a href='/categories/network/'>Network</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" class="post-tag no-text-decoration" >阅读笔记</a> <a href="/tags/network/" class="post-tag no-text-decoration" >Network</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=《 Web 性能权威指南》阅读笔记 - 无线网络性能 - Dirtmelon&url=https://dirtmelon.github.io/posts/high-performance-browser-networking-third/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=《 Web 性能权威指南》阅读笔记 - 无线网络性能 - Dirtmelon&u=https://dirtmelon.github.io/posts/high-performance-browser-networking-third/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=《 Web 性能权威指南》阅读笔记 - 无线网络性能 - Dirtmelon&url=https://dirtmelon.github.io/posts/high-performance-browser-networking-third/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/iglistkit-first/">IGListKit - 开篇</a><li><a href="/posts/iglistkit-second/">IGListKit 的基石 - IGListSectionController</a><li><a href="/posts/iglistkit-third/">IGListKit 的管理者 - IGListAdapter</a><li><a href="/posts/cocoapods-sync-githooks/">一种使用 CocoaPods 同步 Git hooks 的方案</a><li><a href="/posts/cocoapods-first/">CocoaPods 学习记录 - 官方文档</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">阅读笔记</a> <a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">源码解析</a> <a class="post-tag" href="/tags/swift/">Swift</a> <a class="post-tag" href="/tags/%E7%BF%BB%E8%AF%91/">翻译</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/texture/">Texture</a> <a class="post-tag" href="/tags/cocoapods/">CocoaPods</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/high-performance-browser-networking-second/"><div class="card-body"> <span class="timeago small" > Oct 26, 2020 <i class="unloaded">2020-10-26T20:07:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《 Web 性能权威指南》阅读笔记-HTTP</h3><div class="text-muted small"><p> HTTP 简史 HTTP （ HyperText Transfer Protocol ，超文本传输协议）是互联网上最普遍采用的一种应用协议，也是客户端与服务器之间的共用语言，是现代 Web 的基础。从最初的一个关键字和文档路径开始， HTTP 最终不仅成为了浏览器的协议，而且也几乎成为了所有互联网软件和硬件应用的协议。 HTTP 0.9 ：只有一行的协议 Tim Berners-Lee 最...</p></div></div></a></div><div class="card"> <a href="/posts/high-performance-browser-networking-first/"><div class="card-body"> <span class="timeago small" > Oct 18, 2020 <i class="unloaded">2020-10-18T15:47:28+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《 Web 性能权威指南》阅读笔记-网络技术概览</h3><div class="text-muted small"><p> 延迟与带宽 WPO （ Web Performance Optimization ，Web性能优化）产业从无到有，快速增长，充分说明用户越来越重视速度方面的用户体验。速度是关键： 网站越快，用户的黏性越高； 网站越快，用户忠诚度更高； 网站越快，用户转化率越高。 不仅限于网站，移动端也是相同的情况。 延迟和带宽是影响速度的两个关键因素。 延迟是 message 或 pack...</p></div></div></a></div><div class="card"> <a href="/posts/advanced-swift-collections/"><div class="card-body"> <span class="timeago small" > Mar 13, 2017 <i class="unloaded">2017-03-13T22:03:06+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>《Swift进阶》阅读笔记 - 集合类型</h3><div class="text-muted small"><p> 数组 高阶函数 实现map函数，把for循环中的代码模版部分用一个泛型函数封装起来。下面是可能的实现方式： extension Array { func map&lt;T&gt;(_ transform: (Element) -&gt; T) -&gt; [T] { var result: [T] = [] result.reserveCapacit...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/high-performance-browser-networking-second/" class="btn btn-outline-primary" prompt="Older"><p>《 Web 性能权威指南》阅读笔记-HTTP</p></a> <a href="/posts/iglistkit-first/" class="btn btn-outline-primary" prompt="Newer"><p>IGListKit - 开篇</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//dirtmelon-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = '《 Web 性能权威指南》阅读笔记 - 无线网络性能'; this.page.url = 'https://dirtmelon.github.io/posts/high-performance-browser-networking-third/'; this.page.identifier = '/posts/high-performance-browser-networking-third/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/Dirt_melon">dirtmelon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">阅读笔记</a> <a class="post-tag" href="/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">源码解析</a> <a class="post-tag" href="/tags/swift/">Swift</a> <a class="post-tag" href="/tags/%E7%BF%BB%E8%AF%91/">翻译</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/network/">Network</a> <a class="post-tag" href="/tags/texture/">Texture</a> <a class="post-tag" href="/tags/cocoapods/">CocoaPods</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dirtmelon.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-GZ7JRH6MFN"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-GZ7JRH6MFN'); }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script>
