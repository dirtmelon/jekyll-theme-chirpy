---
layout: post
title: 《 Web 性能权威指南》阅读笔记 - 浏览器 API 与协议
date: 2020-10-26 20:07 +0800
tags: [阅读笔记, Network]
categories: [Code, Network]
---

## WebSocket
WebSocket 可以实现客户端与服务器间双向、基于消息的文本或二进制数据传输。它是浏览器中最靠近套接字的 API 。 WebSocket 是一种网络传输协议，可在单个 TCP 连接上进行全双工通信。
WebSocket 使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在 WebSocket API 中，浏览器和服务器只需要完成一次握手，两者之间就可以创建持久性的连接，并进行双向数据传输。
优点：
- 较少的控制开销，在连接创建后，服务器和客户端之间交换数据时，用于协议控制的数据包头部相对较小。
- 更强的实时性。由于协议是全双工的，所以服务器可以随时主动给客户端下发数据。相对于 HTTP 请求需要等待客户端发起请求服务端才能响应，延迟明显更少。
- 保持连接状态。与 HTTP 不同的是， Websocket 需要先创建连接，这就使得其成为一种有状态的协议，之后通信时可以省略部分状态信息。而 HTTP 请求可能需要在每个请求都携带状态信息。
- 更好的二进制支持。 Websocket 定义了二进制帧，相对 HTTP ，可以更轻松地处理二进制内容。
* 可以支持扩展。 Websocket 定义了扩展，用户可以扩展协议、实现部分自定义的子协议。如部分浏览器支持压缩等。
* 更好的压缩效果。相对于 HTTP 压缩 ， Websocket 在适当的扩展支持下，可以沿用之前内容的上下文，在传递类似的数据时，可以显著地提高压缩率。

#### WS 与 WSS
WebSocket 资源 URL 采用了自定义模式： ws 表示纯文本通信（如 ws://example.com/socket ）， wss 表示使用加密信道通信（ TCP+TLS ）。为什么不使用 http 而要自定义呢？ WebSocket 的主要目的，是在浏览器中的应用与服务器之间提供优化的、双向通信机制。可是， WebSocket 的连接协议也可以用于浏览器之外的场景，可以通过非HTTP协商机制交换数据。


#### 接收文本和二进制数据
WebSocket 通信只涉及消息，应用代码无需担心缓冲、解析、重建接收到的数据。比如，服务器发来了一个 1 MB 的净荷，应用的 onmessage 回调只会在客户端接收到全部数据时才会被调用。

